<!DOCTYPE html>
<html>
    <head>
        <style>
            #slider{
                width: 510px;
            }
            table, canvas{
                display: inline-block;
            }
            .x, .y{
                width: 50px;
            }
        </style>
    </head>
    <body style="text-align:center;">
        <canvas id='cnvs' width="510px" height="510px" style="border: 1px black solid"></canvas>
        <table>
            <tr>
                <td><input type="number" value="0" class='x'></td>
                <td><input type="number" value="0" class='y'></td>
            </tr>
            <tr>
                <td><input type="number" value="50" class='x'></td>
                <td><input type="number" value="50" class='y'></td>
            </tr>
            <tr>
                <td><input type="number" value="200" class='x'></td>
                <td><input type="number" value="50" class='y'></td>
            </tr>
            <tr>
                <td><input type="number" value="120" class='x'></td>
                <td><input type="number" value="150" class='y'></td>
            </tr>
            <tr>
                <td><input type="number" value="100" class='x'></td>
                <td><input type="number" value="200" class='y'></td>
            </tr>
            <tr>
                <td><input type="number" value="50" class='x'></td>
                <td><input type="number" value="100" class='y'></td>
            </tr>
        </table>
        <input type="range" id='slider' max="3" step="0.01">
    </body>
    <script>
        let xTDs = document.getElementsByClassName('x')
        let yTDs = document.getElementsByClassName('y')

        let cnvs = document.getElementById('cnvs');
        let ctx = cnvs.getContext('2d');

        function iPart(i){
            return i - Math.floor(i)
        }

        function fun1 (t, list){
            let cord1 = list[Math.floor(t)];
            let cord2 = list[Math.ceil(t)];
            return iPart(t) * (cord2 - cord1) + cord1;
        }

        function fun2 (t, list){
            let t3 = Math.ceil(t) + 1
            let xCord1 = xList[Math.floor(t)];
            let xCord2 = xList[Math.ceil(t)];
            let yCord1 = yList[Math.floor(t)];
            let yCord2 = yList[Math.ceil(t)];
            return ((t3) * (xCord2 - xCord1) + xCord1 - xList[t3]) * (1-iPart(t)) * iPart(t)
        }

        function renderSpline(curve){
            ctx.clearRect(0, 0, cnvs.width, cnvs.height);
            console.log('render');
            xList = []
            yList = []
            for(i in xTDs){
                xList.push(parseInt(xTDs[i].value))
                yList.push(parseInt(yTDs[i].value))
            }

            for(i in xList){
                ctx.beginPath();
                ctx.arc(xList[i]+10, 500-yList[i], 5, 0, 2*Math.PI);
                ctx.stroke();
            }

            for(let t = 0.1; t<xList.length; t+=0.01){
                t = Math.round(t*100)/100
                let x = fun1(t, xList);
                let y = fun1(t, yList);
                if(t + 2 < xList.length){
                    x += fun2(t, xList) * curve
                    y += fun2(t, yList) * curve
                    // console.log(t, fun2(t, xList), fun2(t, yList))
                }
                // if(t > 2){
                //     console.log(fun3(t, xList))
                //     x += fun3(t, xList)
                //     y += fun3(t, yList)
                // }
                ctx.beginPath();
                ctx.arc(x+10, 500-y, 2, 0, 2*Math.PI)
                ctx.stroke();
            }
        }

        // function fun3(t, list){
        //     let t0 = Math.floor(t) - 1
        //     let cord1 = list[Math.floor(t)];
        //     let cord2 = list[Math.ceil(t)];
        //     return ((t0 - Math.floor(t)) * (cord2 - cord1) + cord1 ) * (1-iPart(t)) * iPart(t)**2
        // }

        renderSpline(1)

        document.getElementById('slider').addEventListener('change', ()=>{
            renderSpline(document.getElementById('slider').value)
        })

        // for(i in xTDs){
        //     xTDs[i].addEventListener('change', ()=>{
        //         renderSpline(document.getElementById('slider').value)
        //     })
        //     yTDs[i].addEventListener('change', ()=>{
        //         renderSpline(document.getElementById('slider').value)
        //     })
        // }
    </script>
</html>